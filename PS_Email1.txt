Import-Module ActiveDirectory
$Groups = (Get-AdGroup -filter * | Where {$_.name -like "*ad name*"} | select name -expandproperty name)
$np_Groups = (Get-AdGroup -filter * | Where {$_.name -like "ad name like*"} | select name -expandproperty name)

$Record = [ordered]@{
"Group Name" = ""
"Name" = ""
"Username" = ""
}
##PROD
Foreach ($Group in $Groups)
{

$Arrayofmembers = Get-ADGroupMember -identity $Group | select name,samaccountname
$Table = @()

echo $Group.name

foreach ($Member in $Arrayofmembers)
{
$Record."Group Name" = $Group
$Record."Name" = $Member.name
$Record."UserName" = $Member.samaccountname
$objRecord = New-Object PSObject -property $Record
$Table += $objrecord
$Table | Export-csv "E:\CloudGovernance\ADFiles\$Group.csv" -NoTypeInformation ##files from AD to Local | PROD AD
}
}
##Non-PROD
Foreach ($np_Group in $np_Groups)
{

$Arrayofmembers = Get-ADGroupMember -identity $np_Group | select name,samaccountname
$Table = @()

echo $np_Group.name

foreach ($Member in $Arrayofmembers)
{
$Record."Group Name" = $np_Group
$Record."Name" = $Member.name
$Record."UserName" = $Member.samaccountname
$objRecord = New-Object PSObject -property $Record
$Table += $objrecord
$Table | Export-csv "E:\CloudGovernance\ADFiles\$np_Group.csv" -NoTypeInformation ##files from AD to Local | Non-PROD AD
}
}

##########################################
########                        ##########
########  Email funcationality  ##########
########                        ##########
##########################################

$AssociationList = Import-Csv -path "E:\CloudGovernance\AssociationFile\Association.csv" # path of the Association List File 
$Smtp_Server = 'SMTP Server NAME'
$smptp_port ='25'
$Fromemail = 'from email'
$subject = 'subject of the email' 

function email {

$color ="darkblue"
$path = "E:\CloudGovernance\ADFiles\" ## All the Excel Files
$url= "your url for the hyperlink"
$body = "<h3>body of the email. line-1<h3><br>" 
$body += "<font color =$color>body of the email. line-2</font> <br><br>"
$body += "<font color =$color>body of the email. line-3</font> <br><br>"
$body += "<b><font color =$color>Link to </font></b><a href= $url>Access Request </a> <b><font color = $color>if you need to add</font></b><br>"
#Signature
$body += "<br><br><font color=$color>Thanks,</font><br>"
$body += "<font color=$color>signature</font><br>"
$body += "<font color=$color>signature-2</font>"
 $mailparam1 = @{
					    From=$FromEmail
				        To=$Association.DL					
					    ##Subject = $subject + $Association.FileName
                        Subject = $subject
					    Body =$body
					    Attachments=$path + $Association.FileName
					    smtpserver=$Smtp_Server
					    Port=$smptp_port
					    ##Credential=$Creds                  					
						
				        }
send-MailMessage @mailparam1 -BodyAsHtml -DeliveryNotificationOption OnSuccess, OnFailure        

}

foreach($Association in $AssociationList)
{
  $recipients =$Association.DL
  foreach ($recipient in $recipients)
  {   
    email
  }
}

#This is created on RR.
##update it in the LR
update
